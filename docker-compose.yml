version: '3'
services:
  webapi:
    # build using Dockerfile of webapi project
    build: ./src/WebApi/BillVu.WebApi
    ports:
     - "5000:5001"
    container_name: billvu.webapi
  spa:
    # build using Dockerfile of spa project
    build: ./src/SPA/billvu-spa
    ports:
      - "4999:4999"
    volumes:
      - '.:/usr/src/app'
      - '/usr/src/app/node_modules'
    container_name: billvu.spa
after_success:
  - docker --version  # document the version travis is using
  - pip install --user awscli # install aws cli w/o sudo
  - export PATH=$PATH:$HOME/.local/bin # put aws in the path
  - eval $(aws ecr get-login --no-include-email --region us-east-1) #needs AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY envvars
  #- docker build -t my_example_app .
  - docker tag billvu_spa:latest $AWS_ACCOUNT/billvu_spa:latest
  - docker push $AWS_ACCOUNT/billvu_spa:latest
  - docker tag billvu_webapi:latest $AWS_ACCOUNT/billvu_webapi:latest
  - docker push $AWS_ACCOUNT/billvu_webapi:latest